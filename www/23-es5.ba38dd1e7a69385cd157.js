(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{jGpJ:function(n,l,t){"use strict";t.r(l);var e=t("CcnG"),u=t("mrSG"),o=t("qfBg"),i=t("kVqo"),s=t("2Rin"),r=t("S3Px"),c=t("ZZ/e"),a=t("Hzbo"),d=t("r4Kj"),b=t("t/Na"),p=function(){function n(n,l){this.http=n,this.config=l}return n.prototype.postPayInfo=function(n){return this.http.get(this.config.DOMAIN+"pay_info?subject="+n.subject+"&body="+n.body+"&amount="+n.amount+"&outTradeId="+n.outTradeId)},n.prototype.queryOrder=function(n,l){return this.http.get(this.config.DOMAIN+"query_order?sn="+n+"&trade_id="+l)},n.prototype.postWxPay=function(n){return this.http.post(this.config.DOMAIN+"wx_pay/order",n)},n.prototype.getOpenId=function(n){return this.http.get(this.config.DOMAIN+"pay/wx_pay/getOpenId?code="+n)},n.prototype.creatWxpayOrder=function(n,l){return this.http.get(this.config.DOMAIN+"pay/wx_pay/order?openid="+l+"&attach="+n.attach+"&body="+n.body+"&total_fee="+n.total_fee+"&out_trade_no="+n.out_trade_no)},n.prototype.orderQuery=function(n){return this.http.get(this.config.DOMAIN+"pay/wx_pay/public/orderQuery?out_trade_no="+n)},n.ngInjectableDef=e.Qb({factory:function(){return new n(e.Rb(b.c),e.Rb(d.a))},token:n,providedIn:"root"}),n}(),h=function(){function n(n,l,t,e,u,o,i,s,r,c){var a=this;this.userService=n,this.ordersService=l,this.storage=t,this.utilService=e,this.productsService=u,this.navCtrl=o,this.notificationService=i,this.payService=s,this.alertController=r,this.activeRoute=c,this.address=null,this.orders=[],this.subject="",this.body="",this.sum=0,this.hasPay=!1,this.payway=1,this.storage.get("orders").then((function(n){null!=n&&(a.orders=n,a.getSum(n))})),this.storage.get("no").then((function(n){null!=n&&(a.no=n)})),this.storage.get("sn").then((function(n){null!=n&&(a.sn=n)})),this.orders.map((function(n){a.productsService.getProductById(n.product._id).subscribe((function(n){0!==n.data.pro_status&&a.utilService.showToast(n.data.name+"\u5df1\u4e0b\u67b6\u6216\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u4e0b\u5355\uff01")}))}))}return n.prototype.ngOnInit=function(){},n.prototype.ionViewDidEnter=function(){var n=this;this.storage.get("user").then((function(l){null!=l&&(n.userId=l._id,n.getDefaultAddress(l._id))})),this.userService.httpGetAdminId().subscribe((function(l){0===l.code&&(n.adminId=l.data._id,n.adminPhone=l.data.phone)})),-1!==window.location.href.indexOf("code")&&this.activeRoute.queryParams.subscribe((function(l){n.code=l.code,n.getOpenId(l.code)}))},n.prototype.getSum=function(n){for(var l=0,t=0;t<n.length;t++)l+=(n[t].num?n[t].num:0)*n[t].product.price,this.subject+=n[t].product.name+" ",this.body+=n[t].product.name+"x"+n[t].num+" ";this.sum=l.toFixed(2)},n.prototype.getDefaultAddress=function(n){var l=this;this.userService.getDefaultUserAddress(n).subscribe((function(n){0===n.code&&null!=n.data&&(l.address=n.data.address,l.name=n.data.name,l.phone=n.data.phone,l.changeAddress(l.no,n.data._id))}))},n.prototype.changeAddress=function(n,l){this.ordersService.httpChangeAddress(n,l).subscribe((function(n){}))},n.prototype.selectAddress=function(){this.navCtrl.navigateForward("/address")},n.prototype.changeOrderStatus=function(n){var l=this;this.ordersService.httpUpdateOrderById(this.no,n).subscribe((function(n){0===n.code&&l.navCtrl.navigateForward("/orders")}))},n.prototype.userOrderNotification=function(n){this.notificationService.createNotification(n).subscribe((function(n){0===n.code&&console.log("success")}))},n.prototype.msgToBusiness=function(n,l){this.notificationService.msgToBusiness(n,l).subscribe((function(n){0===n.code&&console.log("success")}))},n.prototype.changePayDate=function(n){this.ordersService.httpChangePayDate(n).subscribe((function(n){0===n.code&&console.log(n.msg)}))},n.prototype.confirmPay=function(){var n=this;this.orders.map((function(l){n.productsService.getProductById(l.product._id).subscribe((function(t){if(0!=t.data.pro_status||t.data.price!=l.product.price)n.utilService.showToast(t.data.name+"\u5546\u54c1\u4fe1\u606f\u5df1\u53d8\u66f4\uff0c\u8bf7\u91cd\u65b0\u4e0b\u5355\uff01");else if(null==n.address)n.utilService.showToast("\u8bf7\u9009\u62e9\u6536\u8d27\u5730\u5740\uff01");else if(1===n.payway&&"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)){var e=encodeURIComponent("http://wap.gxyingken.com/pay-order");window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxb80d00a17cb6631d&redirect_uri="+e+"&response_type=code&scope=snsapi_userinfo&state=123#wechat_redirect"}}))}))},n.prototype.getOpenId=function(n){var l=this;this.payService.getOpenId(n).subscribe((function(n){l.openId=n.openid,l.payOurMoney()}))},n.prototype.payOurMoney=function(){var n=this;this.payService.creatWxpayOrder({attach:this.subject,body:this.body,out_trade_no:this.sn,total_fee:.01},this.openId).subscribe((function(l){return u.b(n,void 0,void 0,(function(){var n,t=this;return u.e(this,(function(e){switch(e.label){case 0:return console.log(l),[4,this.alertController.create({header:"\u786e\u8ba4\u652f\u4ed8\u7ed3\u679c",buttons:[{text:"\u652f\u4ed8\u9047\u5230\u95ee\u9898",handler:function(){n.dismiss()}},{text:"\u5df1\u5b8c\u6210\u652f\u4ed8",handler:function(){t.orderQuery(n)}}]})];case 1:return[4,(n=e.sent()).present()];case 2:return e.sent(),[2]}}))}))}),(function(l){n.utilService.showToast(l)}))},n.prototype.orderQuery=function(n){var l=this,t=this;this.payService.orderQuery(this.sn).subscribe((function(e){console.log(e),200===e.data.code?(t.userOrderNotification({content:"\u60a8\u6536\u5230\u65b0\u7684\u8ba2\u5355\uff1a"+t.sn+" \u8bf7\u5c3d\u5feb\u5904\u7406\uff01",from:t.userId,to:t.adminId}),t.msgToBusiness(t.adminPhone,t.sn),t.userOrderNotification({content:"\u60a8\u7684\u8ba2\u5355\uff1a"+t.sn+" \u5df1\u7ecf\u751f\u6210\uff0c\u6211\u4eec\u4f1a\u5c3d\u5feb\u4e3a\u60a8\u53d1\u8d27\uff01\u975e\u5e38\u611f\u8c22\u60a8\u7684\u8ba2\u8d2d\uff0c\u795d\u751f\u6d3b\u6109\u5feb\uff01\u7535\u8bdd\u54a8\u8be2\uff1a18078660058",from:t.adminId,to:t.userId}),t.changeOrderStatus(t.payway),t.changePayDate(t.sn),t.hasPay=!0):l.utilService.showToast(e.data.msg),n.dismiss()}))},n}(),f=function(){return function(){}}(),g=t("pMnS"),m=t("oBZk"),y=t("Ip0R"),v=t("iw74"),x=t("ZYCi"),O=e.rb({encapsulation:0,styles:[[".btn[_ngcontent-%COMP%]{font-size:13px;width:100px;--background:#24ad20;--background-activated:#24ad20}.foot-price[_ngcontent-%COMP%]{padding:0 15px;color:#555}.foot-price[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{color:#e62465}.address-box[_ngcontent-%COMP%]{margin-bottom:8px}.address[_ngcontent-%COMP%]{padding:20px 0;font-size:13px;color:#555;line-height:20px}.pay-way[_ngcontent-%COMP%]{font-size:13px;color:#555;line-height:20px;margin-bottom:8px}.product-list[_ngcontent-%COMP%]{margin-bottom:0}.list-item[_ngcontent-%COMP%]{padding:10px 0}.position[_ngcontent-%COMP%]{font-size:16px;margin-bottom:10px}.product-name[_ngcontent-%COMP%]{font-size:13px;line-height:20px;font-weight:400}.price-box[_ngcontent-%COMP%]{font-size:12px;color:#999}.price-box[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{font-size:12px}"]],data:{}});function _(n){return e.Nb(0,[(n()(),e.tb(0,0,null,null,22,"ion-item",[["class","list-item"]],null,null,null,m.eb,m.s)),e.sb(1,49152,null,0,c.I,[e.h,e.k,e.z],null,null),(n()(),e.tb(2,0,null,0,2,"ion-thumbnail",[["item-start",""]],null,null,null,m.vb,m.J)),e.sb(3,49152,null,0,c.Ab,[e.h,e.k,e.z],null,null),(n()(),e.tb(4,0,null,0,0,"img",[],[[8,"src",4]],null,null,null,null)),(n()(),e.tb(5,0,null,0,17,"div",[["class","price-box"],["style","flex: 1;"]],null,null,null,null,null)),(n()(),e.tb(6,0,null,null,1,"h2",[["class","product-name"]],null,null,null,null,null)),(n()(),e.Lb(7,null,["",""])),(n()(),e.tb(8,0,null,null,14,"ion-row",[],null,null,null,m.jb,m.x)),e.sb(9,49152,null,0,c.kb,[e.h,e.k,e.z],null,null),(n()(),e.tb(10,0,null,0,4,"ion-col",[],null,null,null,m.T,m.h)),e.sb(11,49152,null,0,c.u,[e.h,e.k,e.z],null,null),(n()(),e.tb(12,0,null,0,2,"p",[["text-right",""]],null,null,null,null,null)),e.sb(13,16384,null,0,c.d,[e.k],null,null),(n()(),e.Lb(14,null,["x ",""])),(n()(),e.tb(15,0,null,0,7,"ion-col",[["col-2",""]],null,null,null,m.T,m.h)),e.sb(16,49152,null,0,c.u,[e.h,e.k,e.z],null,null),(n()(),e.tb(17,0,null,0,5,"p",[["text-right",""]],null,null,null,null,null)),e.sb(18,16384,null,0,c.d,[e.k],null,null),(n()(),e.Lb(-1,null,["\uffe5"])),(n()(),e.tb(20,0,null,null,1,"b",[["class","red"]],null,null,null,null,null)),(n()(),e.Lb(21,null,["",""])),(n()(),e.Lb(-1,null,["\u5143"]))],null,(function(n,l){n(l,4,0,e.xb(1,"",l.context.$implicit.product.banner.path,"")),n(l,7,0,l.context.$implicit.product.name),n(l,14,0,l.context.$implicit.num?l.context.$implicit.num:0),n(l,21,0,((l.context.$implicit.num?l.context.$implicit.num:0)*l.context.$implicit.product.price).toFixed(2))}))}function k(n){return e.Nb(0,[(n()(),e.tb(0,0,null,null,3,"ion-list",[["class","product-list"],["lines","none"]],null,null,null,m.gb,m.u)),e.sb(1,49152,null,0,c.P,[e.h,e.k,e.z],{lines:[0,"lines"]},null),(n()(),e.ib(16777216,null,0,1,null,_)),e.sb(3,278528,null,0,y.i,[e.O,e.L,e.s],{ngForOf:[0,"ngForOf"]},null)],(function(n,l){var t=l.component;n(l,1,0,"none"),n(l,3,0,t.orders)}),null)}function I(n){return e.Nb(0,[(n()(),e.tb(0,0,null,null,11,"ion-header",[],null,null,null,m.Z,m.n)),e.sb(1,49152,null,0,c.C,[e.h,e.k,e.z],null,null),(n()(),e.tb(2,0,null,0,9,"ion-toolbar",[["class","toolbar"]],null,null,null,m.xb,m.L)),e.sb(3,49152,null,0,c.Db,[e.h,e.k,e.z],null,null),(n()(),e.tb(4,0,null,0,4,"ion-buttons",[["slot","start"]],null,null,null,m.R,m.f)),e.sb(5,49152,null,0,c.m,[e.h,e.k,e.z],null,null),(n()(),e.tb(6,0,null,0,2,"ion-back-button",[["mode","md"]],null,[[null,"click"]],(function(n,l,t){var u=!0;return"click"===l&&(u=!1!==e.Fb(n,8).onClick(t)&&u),u}),m.O,m.c)),e.sb(7,49152,null,0,c.h,[e.h,e.k,e.z],{mode:[0,"mode"]},null),e.sb(8,16384,null,0,c.i,[[2,c.jb],c.Jb],null,null),(n()(),e.tb(9,0,null,0,2,"ion-title",[],null,null,null,m.wb,m.K)),e.sb(10,49152,null,0,c.Bb,[e.h,e.k,e.z],null,null),(n()(),e.Lb(-1,0,["\u786e\u8ba4\u8ba2\u5355"])),(n()(),e.tb(12,0,null,null,24,"ion-content",[["class","content"]],null,null,null,m.U,m.i)),e.sb(13,49152,null,0,c.v,[e.h,e.k,e.z],null,null),(n()(),e.tb(14,0,null,0,6,"ion-item",[["class","address-box"],["detail",""],["lines","none"]],null,[[null,"click"]],(function(n,l,t){var e=!0;return"click"===l&&(e=!1!==n.component.selectAddress()&&e),e}),m.eb,m.s)),e.sb(15,49152,null,0,c.I,[e.h,e.k,e.z],{detail:[0,"detail"],lines:[1,"lines"]},null),(n()(),e.tb(16,0,null,0,4,"div",[["class","address"]],null,null,null,null,null)),(n()(),e.tb(17,0,null,null,1,"p",[["class","position"]],null,null,null,null,null)),(n()(),e.Lb(18,null,["",""])),(n()(),e.tb(19,0,null,null,1,"p",[["class","user"]],null,null,null,null,null)),(n()(),e.Lb(20,null,[""," ",""])),(n()(),e.tb(21,0,null,0,6,"ion-item",[["class","pay-way"],["lines","none"]],null,null,null,m.eb,m.s)),e.sb(22,49152,null,0,c.I,[e.h,e.k,e.z],{lines:[0,"lines"]},null),(n()(),e.tb(23,0,null,0,2,"ion-label",[],null,null,null,m.fb,m.t)),e.sb(24,49152,null,0,c.O,[e.h,e.k,e.z],null,null),(n()(),e.Lb(-1,0,["\u652f\u4ed8\u65b9\u5f0f"])),(n()(),e.tb(26,0,null,0,1,"div",[["slot","end"]],null,null,null,null,null)),(n()(),e.Lb(-1,null,["\u5fae\u4fe1\u652f\u4ed8"])),(n()(),e.ib(16777216,null,0,1,null,k)),e.sb(29,16384,null,0,y.j,[e.O,e.L],{ngIf:[0,"ngIf"]},null),(n()(),e.tb(30,0,null,0,6,"ion-item",[["lines","none"]],null,null,null,m.eb,m.s)),e.sb(31,49152,null,0,c.I,[e.h,e.k,e.z],{lines:[0,"lines"]},null),(n()(),e.tb(32,0,null,0,4,"div",[["class","foot-price"],["slot","end"]],null,null,null,null,null)),(n()(),e.Lb(-1,null,["\uffe5"])),(n()(),e.tb(34,0,null,null,1,"b",[],null,null,null,null,null)),(n()(),e.Lb(35,null,["",""])),(n()(),e.Lb(-1,null,["\u5143"])),(n()(),e.tb(37,0,null,null,13,"ion-footer",[],null,null,null,m.X,m.l)),e.sb(38,49152,null,0,c.A,[e.h,e.k,e.z],null,null),(n()(),e.tb(39,0,null,0,11,"ion-toolbar",[],null,null,null,m.xb,m.L)),e.sb(40,49152,null,0,c.Db,[e.h,e.k,e.z],null,null),(n()(),e.tb(41,0,null,0,9,"ion-buttons",[["slot","end"]],null,null,null,m.R,m.f)),e.sb(42,49152,null,0,c.m,[e.h,e.k,e.z],null,null),(n()(),e.tb(43,0,null,0,4,"div",[["class","foot-price"]],null,null,null,null,null)),(n()(),e.Lb(-1,null,["\uffe5"])),(n()(),e.tb(45,0,null,null,1,"b",[],null,null,null,null,null)),(n()(),e.Lb(46,null,["",""])),(n()(),e.Lb(-1,null,["\u5143"])),(n()(),e.tb(48,0,null,0,2,"ion-button",[["class","btn"],["expand","full"],["fill","solid"],["size","default"]],null,[[null,"click"]],(function(n,l,t){var e=!0;return"click"===l&&(e=!1!==n.component.confirmPay()&&e),e}),m.Q,m.e)),e.sb(49,49152,null,0,c.l,[e.h,e.k,e.z],{disabled:[0,"disabled"],expand:[1,"expand"],fill:[2,"fill"],size:[3,"size"]},null),(n()(),e.Lb(-1,0,["\u63d0\u4ea4\u8ba2\u5355"]))],(function(n,l){var t=l.component;n(l,7,0,"md"),n(l,15,0,"","none"),n(l,22,0,"none"),n(l,29,0,t.orders.length>0),n(l,31,0,"none"),n(l,49,0,t.hasPay,"full","solid","default")}),(function(n,l){var t=l.component;n(l,18,0,t.address),n(l,20,0,t.name,t.phone),n(l,35,0,t.sum),n(l,46,0,t.sum)}))}function w(n){return e.Nb(0,[(n()(),e.tb(0,0,null,null,1,"app-pay-order",[],null,null,null,I,O)),e.sb(1,114688,null,0,h,[o.a,i.a,v.b,s.a,r.a,c.Jb,a.a,p,c.a,x.a],null,null)],(function(n,l){n(l,1,0)}),null)}var z=e.pb("app-pay-order",h,w,{},{},[]),P=t("gIcY");t.d(l,"PayOrderPageModuleNgFactory",(function(){return S}));var S=e.qb(f,[],(function(n){return e.Cb([e.Db(512,e.j,e.bb,[[8,[g.a,z]],[3,e.j],e.x]),e.Db(4608,y.l,y.k,[e.u,[2,y.r]]),e.Db(4608,P.p,P.p,[]),e.Db(4608,c.b,c.b,[e.z,e.g]),e.Db(4608,c.Ib,c.Ib,[c.b,e.j,e.q]),e.Db(4608,c.Lb,c.Lb,[c.b,e.j,e.q]),e.Db(1073742336,y.b,y.b,[]),e.Db(1073742336,P.o,P.o,[]),e.Db(1073742336,P.e,P.e,[]),e.Db(1073742336,c.Fb,c.Fb,[]),e.Db(1073742336,x.o,x.o,[[2,x.t],[2,x.m]]),e.Db(1073742336,f,f,[]),e.Db(1024,x.k,(function(){return[[{path:"",component:h}]]}),[])])}))}}]);