(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{jGpJ:function(l,n,t){"use strict";t.r(n);var e=t("8Y7J"),u=t("mrSG"),i=t("qfBg"),o=t("kVqo"),s=t("2Rin"),r=t("S3Px"),a=t("ZZ/e"),c=t("Hzbo"),d=t("r4Kj"),b=t("IheW");let h=(()=>{class l{constructor(l,n){this.http=l,this.config=n}postPayInfo(l){return this.http.get(this.config.DOMAIN+"pay_info?subject="+l.subject+"&body="+l.body+"&amount="+l.amount+"&outTradeId="+l.outTradeId)}queryOrder(l,n){return this.http.get(this.config.DOMAIN+"query_order?sn="+l+"&trade_id="+n)}postWxPay(l){return this.http.post(this.config.DOMAIN+"wx_pay/order",l)}getOpenId(l){return this.http.get(this.config.DOMAIN+"pay/wx_pay/getOpenId?code="+l)}creatWxpayOrder(l,n){return this.http.get(this.config.DOMAIN+"pay/wx_pay/order?openid="+n+"&attach="+l.attach+"&body="+l.body+"&total_fee="+l.total_fee+"&out_trade_no="+l.out_trade_no)}orderQuery(l){return this.http.get(this.config.DOMAIN+"pay/wx_pay/public/orderQuery?out_trade_no="+l)}}return l.ngInjectableDef=e.Ob({factory:function(){return new l(e.Pb(b.c),e.Pb(d.a))},token:l,providedIn:"root"}),l})();class p{constructor(l,n,t,e,u,i,o,s,r,a){this.userService=l,this.ordersService=n,this.storage=t,this.utilService=e,this.productsService=u,this.navCtrl=i,this.notificationService=o,this.payService=s,this.alertController=r,this.activeRoute=a,this.address=null,this.orders=[],this.subject="",this.body="",this.sum=0,this.hasPay=!1,this.payway=1,this.storage.get("orders").then(l=>{null!=l&&(this.orders=l,this.getSum(l))}),this.storage.get("no").then(l=>{null!=l&&(this.no=l)}),this.storage.get("sn").then(l=>{null!=l&&(this.sn=l)}),this.orders.map(l=>{this.productsService.getProductById(l.product._id).subscribe(l=>{0!==l.data.pro_status&&this.utilService.showToast(l.data.name+"\u5df1\u4e0b\u67b6\u6216\u5220\u9664\uff0c\u8bf7\u91cd\u65b0\u4e0b\u5355\uff01")})})}ngOnInit(){}ionViewDidEnter(){this.storage.get("user").then(l=>{null!=l&&(this.userId=l._id,this.getDefaultAddress(l._id))}),this.userService.httpGetAdminId().subscribe(l=>{0===l.code&&(this.adminId=l.data._id,this.adminPhone=l.data.phone)}),-1!==window.location.href.indexOf("code")&&this.activeRoute.queryParams.subscribe(l=>{this.code=l.code,this.getOpenId(l.code)})}getSum(l){let n=0;for(let t=0;t<l.length;t++)n+=(l[t].num?l[t].num:0)*l[t].product.price,this.subject+=l[t].product.name+" ",this.body+=l[t].product.name+"x"+l[t].num+" ";this.sum=n.toFixed(2)}getDefaultAddress(l){this.userService.getDefaultUserAddress(l).subscribe(l=>{0===l.code&&null!=l.data&&(this.address=l.data.address,this.name=l.data.name,this.phone=l.data.phone,this.changeAddress(this.no,l.data._id))})}changeAddress(l,n){this.ordersService.httpChangeAddress(l,n).subscribe(l=>{})}selectAddress(){this.navCtrl.navigateForward("/address")}changeOrderStatus(l){this.ordersService.httpUpdateOrderById(this.no,l).subscribe(l=>{0===l.code&&this.navCtrl.navigateForward("/orders")})}userOrderNotification(l){this.notificationService.createNotification(l).subscribe(l=>{0===l.code&&console.log("success")})}msgToBusiness(l,n){this.notificationService.msgToBusiness(l,n).subscribe(l=>{0===l.code&&console.log("success")})}changePayDate(l){this.ordersService.httpChangePayDate(l).subscribe(l=>{0===l.code&&console.log(l.msg)})}confirmPay(){this.orders.map(l=>{this.productsService.getProductById(l.product._id).subscribe(n=>{if(0!=n.data.pro_status||n.data.price!=l.product.price)this.utilService.showToast(n.data.name+"\u5546\u54c1\u4fe1\u606f\u5df1\u53d8\u66f4\uff0c\u8bf7\u91cd\u65b0\u4e0b\u5355\uff01");else if(null==this.address)this.utilService.showToast("\u8bf7\u9009\u62e9\u6536\u8d27\u5730\u5740\uff01");else if(1===this.payway&&"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)){const l="wxb80d00a17cb6631d",n=encodeURIComponent("http://wap.gxyingken.com/pay-order");window.location.href=`https://open.weixin.qq.com/connect/oauth2/authorize?appid=${l}&redirect_uri=${n}&response_type=code&scope=snsapi_userinfo&state=123#wechat_redirect`}})})}getOpenId(l){this.payService.getOpenId(l).subscribe(l=>{this.openId=l.openid,this.payOurMoney()})}payOurMoney(){this.payService.creatWxpayOrder({attach:this.subject,body:this.body,out_trade_no:this.sn,total_fee:.01},this.openId).subscribe(l=>u.b(this,void 0,void 0,(function*(){console.log(l);const n=yield this.alertController.create({header:"\u786e\u8ba4\u652f\u4ed8\u7ed3\u679c",buttons:[{text:"\u652f\u4ed8\u9047\u5230\u95ee\u9898",handler:()=>{n.dismiss()}},{text:"\u5df1\u5b8c\u6210\u652f\u4ed8",handler:()=>{this.orderQuery(n)}}]});yield n.present()})),l=>{this.utilService.showToast(l)})}orderQuery(l){const n=this;this.payService.orderQuery(this.sn).subscribe(t=>{console.log(t),200===t.data.code?(n.userOrderNotification({content:"\u60a8\u6536\u5230\u65b0\u7684\u8ba2\u5355\uff1a"+n.sn+" \u8bf7\u5c3d\u5feb\u5904\u7406\uff01",from:n.userId,to:n.adminId}),n.msgToBusiness(n.adminPhone,n.sn),n.userOrderNotification({content:"\u60a8\u7684\u8ba2\u5355\uff1a"+n.sn+" \u5df1\u7ecf\u751f\u6210\uff0c\u6211\u4eec\u4f1a\u5c3d\u5feb\u4e3a\u60a8\u53d1\u8d27\uff01\u975e\u5e38\u611f\u8c22\u60a8\u7684\u8ba2\u8d2d\uff0c\u795d\u751f\u6d3b\u6109\u5feb\uff01\u7535\u8bdd\u54a8\u8be2\uff1a18078660058",from:n.adminId,to:n.userId}),n.changeOrderStatus(n.payway),n.changePayDate(n.sn),n.hasPay=!0):this.utilService.showToast(t.data.msg),l.dismiss()})}}class g{}var m=t("pMnS"),f=t("oBZk"),x=t("SVse"),y=t("xgBC"),v=t("iInd"),O=e.pb({encapsulation:0,styles:[[".btn[_ngcontent-%COMP%]{font-size:13px;width:100px;--background:#24ad20;--background-activated:#24ad20}.foot-price[_ngcontent-%COMP%]{padding:0 15px;color:#555}.foot-price[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{color:#e62465}.address-box[_ngcontent-%COMP%]{margin-bottom:8px}.address[_ngcontent-%COMP%]{padding:20px 0;font-size:13px;color:#555;line-height:20px}.pay-way[_ngcontent-%COMP%]{font-size:13px;color:#555;line-height:20px;margin-bottom:8px}.product-list[_ngcontent-%COMP%]{margin-bottom:0}.list-item[_ngcontent-%COMP%]{padding:10px 0}.position[_ngcontent-%COMP%]{font-size:16px;margin-bottom:10px}.product-name[_ngcontent-%COMP%]{font-size:13px;line-height:20px;font-weight:400}.price-box[_ngcontent-%COMP%]{font-size:12px;color:#999}.price-box[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{font-size:12px}"]],data:{}});function _(l){return e.Lb(0,[(l()(),e.rb(0,0,null,null,22,"ion-item",[["class","list-item"]],null,null,null,f.eb,f.s)),e.qb(1,49152,null,0,a.I,[e.h,e.k,e.x],null,null),(l()(),e.rb(2,0,null,0,2,"ion-thumbnail",[["item-start",""]],null,null,null,f.vb,f.J)),e.qb(3,49152,null,0,a.Ab,[e.h,e.k,e.x],null,null),(l()(),e.rb(4,0,null,0,0,"img",[],[[8,"src",4]],null,null,null,null)),(l()(),e.rb(5,0,null,0,17,"div",[["class","price-box"],["style","flex: 1;"]],null,null,null,null,null)),(l()(),e.rb(6,0,null,null,1,"h2",[["class","product-name"]],null,null,null,null,null)),(l()(),e.Jb(7,null,["",""])),(l()(),e.rb(8,0,null,null,14,"ion-row",[],null,null,null,f.jb,f.x)),e.qb(9,49152,null,0,a.kb,[e.h,e.k,e.x],null,null),(l()(),e.rb(10,0,null,0,4,"ion-col",[],null,null,null,f.T,f.h)),e.qb(11,49152,null,0,a.u,[e.h,e.k,e.x],null,null),(l()(),e.rb(12,0,null,0,2,"p",[["text-right",""]],null,null,null,null,null)),e.qb(13,16384,null,0,a.d,[e.k],null,null),(l()(),e.Jb(14,null,["x ",""])),(l()(),e.rb(15,0,null,0,7,"ion-col",[["col-2",""]],null,null,null,f.T,f.h)),e.qb(16,49152,null,0,a.u,[e.h,e.k,e.x],null,null),(l()(),e.rb(17,0,null,0,5,"p",[["text-right",""]],null,null,null,null,null)),e.qb(18,16384,null,0,a.d,[e.k],null,null),(l()(),e.Jb(-1,null,["\uffe5"])),(l()(),e.rb(20,0,null,null,1,"b",[["class","red"]],null,null,null,null,null)),(l()(),e.Jb(21,null,["",""])),(l()(),e.Jb(-1,null,["\u5143"]))],null,(function(l,n){l(n,4,0,e.vb(1,"",n.context.$implicit.product.banner.path,"")),l(n,7,0,n.context.$implicit.product.name),l(n,14,0,n.context.$implicit.num?n.context.$implicit.num:0),l(n,21,0,((n.context.$implicit.num?n.context.$implicit.num:0)*n.context.$implicit.product.price).toFixed(2))}))}function k(l){return e.Lb(0,[(l()(),e.rb(0,0,null,null,3,"ion-list",[["class","product-list"],["lines","none"]],null,null,null,f.gb,f.u)),e.qb(1,49152,null,0,a.P,[e.h,e.k,e.x],{lines:[0,"lines"]},null),(l()(),e.gb(16777216,null,0,1,null,_)),e.qb(3,278528,null,0,x.i,[e.M,e.J,e.q],{ngForOf:[0,"ngForOf"]},null)],(function(l,n){var t=n.component;l(n,1,0,"none"),l(n,3,0,t.orders)}),null)}function I(l){return e.Lb(0,[(l()(),e.rb(0,0,null,null,11,"ion-header",[],null,null,null,f.Z,f.n)),e.qb(1,49152,null,0,a.C,[e.h,e.k,e.x],null,null),(l()(),e.rb(2,0,null,0,9,"ion-toolbar",[["class","toolbar"]],null,null,null,f.xb,f.L)),e.qb(3,49152,null,0,a.Db,[e.h,e.k,e.x],null,null),(l()(),e.rb(4,0,null,0,4,"ion-buttons",[["slot","start"]],null,null,null,f.R,f.f)),e.qb(5,49152,null,0,a.m,[e.h,e.k,e.x],null,null),(l()(),e.rb(6,0,null,0,2,"ion-back-button",[["mode","md"]],null,[[null,"click"]],(function(l,n,t){var u=!0;return"click"===n&&(u=!1!==e.Db(l,8).onClick(t)&&u),u}),f.O,f.c)),e.qb(7,49152,null,0,a.h,[e.h,e.k,e.x],{mode:[0,"mode"]},null),e.qb(8,16384,null,0,a.i,[[2,a.jb],a.Jb],null,null),(l()(),e.rb(9,0,null,0,2,"ion-title",[],null,null,null,f.wb,f.K)),e.qb(10,49152,null,0,a.Bb,[e.h,e.k,e.x],null,null),(l()(),e.Jb(-1,0,["\u786e\u8ba4\u8ba2\u5355"])),(l()(),e.rb(12,0,null,null,24,"ion-content",[["class","content"]],null,null,null,f.U,f.i)),e.qb(13,49152,null,0,a.v,[e.h,e.k,e.x],null,null),(l()(),e.rb(14,0,null,0,6,"ion-item",[["class","address-box"],["detail",""],["lines","none"]],null,[[null,"click"]],(function(l,n,t){var e=!0;return"click"===n&&(e=!1!==l.component.selectAddress()&&e),e}),f.eb,f.s)),e.qb(15,49152,null,0,a.I,[e.h,e.k,e.x],{detail:[0,"detail"],lines:[1,"lines"]},null),(l()(),e.rb(16,0,null,0,4,"div",[["class","address"]],null,null,null,null,null)),(l()(),e.rb(17,0,null,null,1,"p",[["class","position"]],null,null,null,null,null)),(l()(),e.Jb(18,null,["",""])),(l()(),e.rb(19,0,null,null,1,"p",[["class","user"]],null,null,null,null,null)),(l()(),e.Jb(20,null,[""," ",""])),(l()(),e.rb(21,0,null,0,6,"ion-item",[["class","pay-way"],["lines","none"]],null,null,null,f.eb,f.s)),e.qb(22,49152,null,0,a.I,[e.h,e.k,e.x],{lines:[0,"lines"]},null),(l()(),e.rb(23,0,null,0,2,"ion-label",[],null,null,null,f.fb,f.t)),e.qb(24,49152,null,0,a.O,[e.h,e.k,e.x],null,null),(l()(),e.Jb(-1,0,["\u652f\u4ed8\u65b9\u5f0f"])),(l()(),e.rb(26,0,null,0,1,"div",[["slot","end"]],null,null,null,null,null)),(l()(),e.Jb(-1,null,["\u5fae\u4fe1\u652f\u4ed8"])),(l()(),e.gb(16777216,null,0,1,null,k)),e.qb(29,16384,null,0,x.j,[e.M,e.J],{ngIf:[0,"ngIf"]},null),(l()(),e.rb(30,0,null,0,6,"ion-item",[["lines","none"]],null,null,null,f.eb,f.s)),e.qb(31,49152,null,0,a.I,[e.h,e.k,e.x],{lines:[0,"lines"]},null),(l()(),e.rb(32,0,null,0,4,"div",[["class","foot-price"],["slot","end"]],null,null,null,null,null)),(l()(),e.Jb(-1,null,["\uffe5"])),(l()(),e.rb(34,0,null,null,1,"b",[],null,null,null,null,null)),(l()(),e.Jb(35,null,["",""])),(l()(),e.Jb(-1,null,["\u5143"])),(l()(),e.rb(37,0,null,null,13,"ion-footer",[],null,null,null,f.X,f.l)),e.qb(38,49152,null,0,a.A,[e.h,e.k,e.x],null,null),(l()(),e.rb(39,0,null,0,11,"ion-toolbar",[],null,null,null,f.xb,f.L)),e.qb(40,49152,null,0,a.Db,[e.h,e.k,e.x],null,null),(l()(),e.rb(41,0,null,0,9,"ion-buttons",[["slot","end"]],null,null,null,f.R,f.f)),e.qb(42,49152,null,0,a.m,[e.h,e.k,e.x],null,null),(l()(),e.rb(43,0,null,0,4,"div",[["class","foot-price"]],null,null,null,null,null)),(l()(),e.Jb(-1,null,["\uffe5"])),(l()(),e.rb(45,0,null,null,1,"b",[],null,null,null,null,null)),(l()(),e.Jb(46,null,["",""])),(l()(),e.Jb(-1,null,["\u5143"])),(l()(),e.rb(48,0,null,0,2,"ion-button",[["class","btn"],["expand","full"],["fill","solid"],["size","default"]],null,[[null,"click"]],(function(l,n,t){var e=!0;return"click"===n&&(e=!1!==l.component.confirmPay()&&e),e}),f.Q,f.e)),e.qb(49,49152,null,0,a.l,[e.h,e.k,e.x],{disabled:[0,"disabled"],expand:[1,"expand"],fill:[2,"fill"],size:[3,"size"]},null),(l()(),e.Jb(-1,0,["\u63d0\u4ea4\u8ba2\u5355"]))],(function(l,n){var t=n.component;l(n,7,0,"md"),l(n,15,0,"","none"),l(n,22,0,"none"),l(n,29,0,t.orders.length>0),l(n,31,0,"none"),l(n,49,0,t.hasPay,"full","solid","default")}),(function(l,n){var t=n.component;l(n,18,0,t.address),l(n,20,0,t.name,t.phone),l(n,35,0,t.sum),l(n,46,0,t.sum)}))}function w(l){return e.Lb(0,[(l()(),e.rb(0,0,null,null,1,"app-pay-order",[],null,null,null,I,O)),e.qb(1,114688,null,0,p,[i.a,o.a,y.b,s.a,r.a,a.Jb,c.a,h,a.a,v.a],null,null)],(function(l,n){l(n,1,0)}),null)}var P=e.nb("app-pay-order",p,w,{},{},[]),q=t("s7LF");t.d(n,"PayOrderPageModuleNgFactory",(function(){return S}));var S=e.ob(g,[],(function(l){return e.Ab([e.Bb(512,e.j,e.Z,[[8,[m.a,P]],[3,e.j],e.v]),e.Bb(4608,x.l,x.k,[e.s,[2,x.r]]),e.Bb(4608,q.p,q.p,[]),e.Bb(4608,a.b,a.b,[e.x,e.g]),e.Bb(4608,a.Ib,a.Ib,[a.b,e.j,e.p]),e.Bb(4608,a.Lb,a.Lb,[a.b,e.j,e.p]),e.Bb(1073742336,x.b,x.b,[]),e.Bb(1073742336,q.o,q.o,[]),e.Bb(1073742336,q.e,q.e,[]),e.Bb(1073742336,a.Fb,a.Fb,[]),e.Bb(1073742336,v.o,v.o,[[2,v.t],[2,v.m]]),e.Bb(1073742336,g,g,[]),e.Bb(1024,v.k,(function(){return[[{path:"",component:p}]]}),[])])}))}}]);