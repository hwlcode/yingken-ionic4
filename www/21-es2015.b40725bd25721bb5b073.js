(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{OXgS:function(l,n,t){"use strict";t.r(n);var u=t("8Y7J"),i=t("mrSG"),o=t("ZZ/e"),e=t("S3Px"),r=t("2Rin"),s=t("34Y5"),a=t("kVqo");class c{constructor(l,n,t,u,i,o,e,r,s,a){this.productService=l,this.activeRoute=n,this.productsService=t,this.navCtrl=u,this.router=i,this.events=o,this.storage=e,this.modalCtrl=r,this.orderService=s,this.utilService=a,this.proNum=0,this.isLogin=!1,this.cartNum=0,this.activeRoute.queryParams.subscribe(l=>{this.id=l.id}),this.events.subscribe("user:login",(l,n)=>{this.userId=l._id,this.isLogin=n}),this.storage.get("user").then(l=>{null!==l&&(this.isLogin=!0,this.userId=l._id)}),this.events.subscribe("cart:add",l=>{let n=0;l.map(l=>{n+=l.num}),this.cartNum=n}),this.storage.get("cart").then(l=>{if(null!==l){let n=0;l.map(l=>{n+=l.num}),this.cartNum=n}})}ngOnInit(){this.getProduct(),this.getProducts()}getProduct(){return i.b(this,void 0,void 0,(function*(){const l=yield this.utilService.showLoading();this.getProductById(this.id).subscribe(n=>{0===n.code&&(this.title=n.data.name,this.banner=n.data.banner.path,this.price=n.data.price,this.unit=n.data.unit,this.originPrice=n.data.origin_price,this.originPriceUnit=n.data.origin_price_unit,this.desc=n.data.desc,this.product=n.data),l.dismiss()},l=>{this.errorMsg=l})}))}getProductById(l){return this.productService.getProductById(l)}getProducts(){this.getProductList("",1).subscribe(l=>{0===l.code&&(this.products=l.data.splice(0,4))},l=>{this.errorMsg=l})}getProductList(l,n){return this.productsService.getProductList(l,n)}goToDetail(l){this.id=l,this.proNum=0,this.getProduct(),this.content.scrollToTop(0),this.router.navigate(["/detail"],{queryParams:{id:l},relativeTo:this.activeRoute})}addToCart(l){return i.b(this,void 0,void 0,(function*(){if(this.isLogin){if(void 0===this.proNum||0===this.proNum)return this.utilService.showToast("\u8bf7\u6dfb\u52a0\u8d2d\u4e70\u7684\u6570\u91cf"),!1;{let n=[];const t={};t.product=l,t.num=this.proNum,n.push(t),this.storage.get("cart").then(u=>{null==u?(this.storage.set("cart",n),this.events.publish("cart:add",n),this.utilService.showToast("\u5546\u54c1\u5df1\u7ecf\u6210\u529f\u6dfb\u52a0\u5230\u8d2d\u7269\u8f66")):(n=u,-1!==JSON.stringify(u).indexOf(l._id)?this.utilService.showToast("\u8d2d\u7269\u8f66\u4e2d\u5df1\u7ecf\u5b58\u5728\u8be5\u5546\u54c1\uff0c\u65e0\u9700\u91cd\u590d\u6dfb\u52a0"):(n.push(t),this.storage.set("cart",n),this.events.publish("cart:add",n),this.utilService.showToast("\u5546\u54c1\u5df1\u7ecf\u6210\u529f\u6dfb\u52a0\u5230\u8d2d\u7269\u8f66")))})}}else(yield this.modalCtrl.create({component:s.a})).present()}))}buyNow(l){return i.b(this,void 0,void 0,(function*(){if(this.isLogin){if(void 0===this.proNum||0===this.proNum)return this.utilService.showToast("\u8bf7\u6dfb\u52a0\u8d2d\u4e70\u7684\u6570\u91cf"),!1;{const n=[],t={};t.product=l,t.num=this.proNum,n.push(t),this.sum=l.price*this.proNum,this.orderService.httpPostOrder({products:JSON.stringify(n),sumPrice:this.sum,customer:this.userId}).subscribe(l=>{0===l.code&&(this.storage.set("orders",n),this.storage.set("sn",l.data.no),this.storage.set("no",l.data.sn),this.navCtrl.navigateForward("/pay-order"))})}}else(yield this.modalCtrl.create({component:s.a})).present()}))}goToCart(){this.navCtrl.navigateRoot("/tabs/cart")}}class d{}var b=t("pMnS"),g=t("oBZk"),h=t("SVse"),p=t("/2TV"),m=t("W+v9"),f=t("s7LF"),v=t("qoxc"),x=t("+ylL"),C=t("iInd"),P=t("xgBC"),k=u.pb({encapsulation:0,styles:[[".detail-header[_ngcontent-%COMP%]{position:fixed}.toolbar[_ngcontent-%COMP%]{--background:transparent;--border-color:transparent}.img-box[_ngcontent-%COMP%]{height:300px;position:relative}.pro-img[_ngcontent-%COMP%]{position:absolute;left:50%;top:50%;-webkit-transform:translate3d(-50%,-50%,0);transform:translate3d(-50%,-50%,0);width:100%;max-height:100%;line-height:100%}.icon-gouwuche[_ngcontent-%COMP%]{font-size:25px}.detail_title[_ngcontent-%COMP%]{font-size:20px;padding:0 10px;margin:15px 0;color:#555;line-height:30px}.price[_ngcontent-%COMP%]{padding:0 10px;color:#555}.old-price[_ngcontent-%COMP%]{padding:0 10px;display:block;margin-bottom:10px;line-height:25px;color:#acacac}.desc[_ngcontent-%COMP%]{margin-bottom:30px}.desc[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-weight:700;margin-bottom:10px;color:#555;padding:0 10px}.desc[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#555;line-height:25px;padding:0 10px;font-size:13px}.pro-num[_ngcontent-%COMP%]{--padding-start:0;margin:10px;color:#555}.pro-num[_ngcontent-%COMP%]   .num-txt[_ngcontent-%COMP%]{--color:#555;font-size:18px}.cart[_ngcontent-%COMP%]{font-size:13px;color:#555;text-align:center;padding:0 15px;position:relative}.cart[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{position:absolute;right:4px;top:0;z-index:1}.btn[_ngcontent-%COMP%]{font-size:13px;width:140px;--background:#24ad20;--background-activated:#24ad20}.top-cart[_ngcontent-%COMP%]{position:relative}.top-cart[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{position:absolute;right:4px;top:4px;z-index:1}"]],data:{}});function M(l){return u.Lb(0,[(l()(),u.rb(0,0,null,null,2,"ion-badge",[["class","badge"],["color","danger"]],null,null,null,g.P,g.d)),u.qb(1,49152,null,0,o.k,[u.h,u.k,u.x],{color:[0,"color"]},null),(l()(),u.Jb(2,0,["",""]))],(function(l,n){l(n,1,0,"danger")}),(function(l,n){l(n,2,0,n.component.cartNum)}))}function O(l){return u.Lb(0,[(l()(),u.rb(0,0,null,null,2,"ion-badge",[["class","badge"],["color","danger"]],null,null,null,g.P,g.d)),u.qb(1,49152,null,0,o.k,[u.h,u.k,u.x],{color:[0,"color"]},null),(l()(),u.Jb(2,0,["",""]))],(function(l,n){l(n,1,0,"danger")}),(function(l,n){l(n,2,0,n.component.cartNum)}))}function _(l){return u.Lb(0,[u.Hb(671088640,1,{content:0}),(l()(),u.rb(1,0,null,null,14,"ion-header",[["class","detail-header"]],null,null,null,g.Z,g.n)),u.qb(2,49152,null,0,o.C,[u.h,u.k,u.x],null,null),(l()(),u.rb(3,0,null,0,12,"ion-toolbar",[["class","toolbar"]],null,null,null,g.xb,g.L)),u.qb(4,49152,null,0,o.Db,[u.h,u.k,u.x],null,null),(l()(),u.rb(5,0,null,0,4,"ion-buttons",[["slot","start"]],null,null,null,g.R,g.f)),u.qb(6,49152,null,0,o.m,[u.h,u.k,u.x],null,null),(l()(),u.rb(7,0,null,0,2,"ion-back-button",[["class","white"],["mode","md"]],null,[[null,"click"]],(function(l,n,t){var i=!0;return"click"===n&&(i=!1!==u.Db(l,9).onClick(t)&&i),i}),g.O,g.c)),u.qb(8,49152,null,0,o.h,[u.h,u.k,u.x],{mode:[0,"mode"]},null),u.qb(9,16384,null,0,o.i,[[2,o.jb],o.Jb],null,null),(l()(),u.rb(10,0,null,0,5,"div",[["class","top-cart"],["slot","end"]],null,null,null,null,null)),(l()(),u.rb(11,0,null,null,2,"ion-fab-button",[["size","small"]],null,[[null,"click"]],(function(l,n,t){var u=!0;return"click"===n&&(u=!1!==l.component.goToCart()&&u),u}),g.W,g.k)),u.qb(12,49152,null,0,o.y,[u.h,u.k,u.x],{size:[0,"size"]},null),(l()(),u.rb(13,0,null,0,0,"span",[["class","iconfont icon-gouwuche"],["style","color: #fff;"]],null,null,null,null,null)),(l()(),u.gb(16777216,null,null,1,null,M)),u.qb(15,16384,null,0,h.j,[u.M,u.J],{ngIf:[0,"ngIf"]},null),(l()(),u.rb(16,0,null,null,36,"ion-content",[["fullscreen","true"]],null,null,null,g.U,g.i)),u.qb(17,49152,[[1,4]],0,o.v,[u.h,u.k,u.x],{fullscreen:[0,"fullscreen"]},null),(l()(),u.rb(18,0,null,0,1,"div",[["class","img-box"]],null,null,null,null,null)),(l()(),u.rb(19,0,null,null,0,"img",[["class","pro-img"]],[[8,"src",4],[8,"alt",0]],null,null,null,null)),(l()(),u.rb(20,0,null,0,1,"h3",[["class","detail_title"]],null,null,null,null,null)),(l()(),u.Jb(21,null,["",""])),(l()(),u.rb(22,0,null,0,4,"p",[["class","price"]],null,null,null,null,null)),(l()(),u.Jb(-1,null,["\uffe5"])),(l()(),u.rb(24,0,null,null,1,"i",[["class","red"]],null,null,null,null,null)),(l()(),u.Jb(25,null,["",""])),(l()(),u.Jb(26,null,["/",""])),(l()(),u.rb(27,0,null,0,3,"del",[["class","old-price"]],null,null,null,null,null)),(l()(),u.Jb(28,null,["\uffe5","/"])),(l()(),u.rb(29,0,null,null,1,"span",[["class","f12"]],null,null,null,null,null)),(l()(),u.Jb(30,null,["",""])),(l()(),u.rb(31,0,null,0,10,"ion-item",[["class","pro-num"],["lines","none"]],null,null,null,g.eb,g.s)),u.qb(32,49152,null,0,o.I,[u.h,u.k,u.x],{lines:[0,"lines"]},null),(l()(),u.rb(33,0,null,0,2,"ion-label",[["class","num-txt"]],null,null,null,g.fb,g.t)),u.qb(34,49152,null,0,o.O,[u.h,u.k,u.x],null,null),(l()(),u.Jb(-1,0,["\u8d2d\u4e70\u6570\u91cf\uff1a"])),(l()(),u.rb(36,0,null,0,5,"app-count",[],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"]],(function(l,n,t){var u=!0;return"ngModelChange"===n&&(u=!1!==(l.component.proNum=t)&&u),u}),p.b,p.a)),u.qb(37,49152,null,0,m.a,[],{myCount:[0,"myCount"]},null),u.Gb(1024,null,f.h,(function(l){return[l]}),[m.a]),u.qb(39,671744,null,0,f.l,[[8,null],[8,null],[8,null],[6,f.h]],{model:[0,"model"]},{update:"ngModelChange"}),u.Gb(2048,null,f.i,null,[f.l]),u.qb(41,16384,null,0,f.j,[[4,f.i]],null,null),(l()(),u.rb(42,0,null,0,4,"div",[["class","desc"]],null,null,null,null,null)),(l()(),u.rb(43,0,null,null,1,"h3",[],null,null,null,null,null)),(l()(),u.Jb(-1,null,["\u5546\u54c1\u63cf\u8ff0"])),(l()(),u.rb(45,0,null,null,1,"p",[],null,null,null,null,null)),(l()(),u.Jb(46,null,["",""])),(l()(),u.rb(47,0,null,0,5,"app-recommended",[],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"productClick"]],(function(l,n,t){var u=!0;return"productClick"===n&&(u=!1!==l.component.goToDetail(t)&&u),u}),v.b,v.a)),u.qb(48,49152,null,0,x.a,[],null,{productClick:"productClick"}),u.Gb(1024,null,f.h,(function(l){return[l]}),[x.a]),u.qb(50,671744,null,0,f.l,[[8,null],[8,null],[8,null],[6,f.h]],{model:[0,"model"]},null),u.Gb(2048,null,f.i,null,[f.l]),u.qb(52,16384,null,0,f.j,[[4,f.i]],null,null),(l()(),u.rb(53,0,null,null,19,"ion-footer",[],null,null,null,g.X,g.l)),u.qb(54,49152,null,0,o.A,[u.h,u.k,u.x],null,null),(l()(),u.rb(55,0,null,0,17,"ion-toolbar",[],null,null,null,g.xb,g.L)),u.qb(56,49152,null,0,o.Db,[u.h,u.k,u.x],null,null),(l()(),u.rb(57,0,null,0,7,"ion-buttons",[["slot","start"]],null,null,null,g.R,g.f)),u.qb(58,49152,null,0,o.m,[u.h,u.k,u.x],null,null),(l()(),u.rb(59,0,null,0,5,"ion-icon-button",[["class","cart"]],null,[[null,"click"]],(function(l,n,t){var u=!0;return"click"===n&&(u=!1!==l.component.goToCart()&&u),u}),null,null)),(l()(),u.rb(60,0,null,null,0,"span",[["class","iconfont icon-gouwuche"]],null,null,null,null,null)),(l()(),u.rb(61,0,null,null,1,"p",[],null,null,null,null,null)),(l()(),u.Jb(-1,null,["\u8d2d\u7269\u8f66"])),(l()(),u.gb(16777216,null,null,1,null,O)),u.qb(64,16384,null,0,h.j,[u.M,u.J],{ngIf:[0,"ngIf"]},null),(l()(),u.rb(65,0,null,0,7,"ion-buttons",[["slot","end"]],null,null,null,g.R,g.f)),u.qb(66,49152,null,0,o.m,[u.h,u.k,u.x],null,null),(l()(),u.rb(67,0,null,0,2,"ion-button",[["class","btn"],["color","secondary"],["expand","full"],["fill","solid"],["size","default"]],null,[[null,"click"]],(function(l,n,t){var u=!0,i=l.component;return"click"===n&&(u=!1!==i.addToCart(i.product)&&u),u}),g.Q,g.e)),u.qb(68,49152,null,0,o.l,[u.h,u.k,u.x],{color:[0,"color"],expand:[1,"expand"],fill:[2,"fill"],size:[3,"size"]},null),(l()(),u.Jb(-1,0,["\u52a0\u5165\u8d2d\u7269\u8f66"])),(l()(),u.rb(70,0,null,0,2,"ion-button",[["class","btn"],["expand","full"],["fill","solid"],["size","default"]],null,[[null,"click"]],(function(l,n,t){var u=!0,i=l.component;return"click"===n&&(u=!1!==i.buyNow(i.product)&&u),u}),g.Q,g.e)),u.qb(71,49152,null,0,o.l,[u.h,u.k,u.x],{expand:[0,"expand"],fill:[1,"fill"],size:[2,"size"]},null),(l()(),u.Jb(-1,0,["\u7acb\u5373\u8d2d\u4e70"]))],(function(l,n){var t=n.component;l(n,8,0,"md"),l(n,12,0,"small"),l(n,15,0,t.cartNum>0),l(n,17,0,"true"),l(n,32,0,"none"),l(n,37,0,t.proNum),l(n,39,0,t.proNum),l(n,50,0,t.products),l(n,64,0,t.cartNum>0),l(n,68,0,"secondary","full","solid","default"),l(n,71,0,"full","solid","default")}),(function(l,n){var t=n.component;l(n,19,0,u.vb(1,"",t.banner,""),u.vb(1,"",t.title,"")),l(n,21,0,t.title),l(n,25,0,t.price),l(n,26,0,t.unit),l(n,28,0,t.originPrice),l(n,30,0,t.originPriceUnit),l(n,36,0,u.Db(n,41).ngClassUntouched,u.Db(n,41).ngClassTouched,u.Db(n,41).ngClassPristine,u.Db(n,41).ngClassDirty,u.Db(n,41).ngClassValid,u.Db(n,41).ngClassInvalid,u.Db(n,41).ngClassPending),l(n,46,0,t.desc),l(n,47,0,u.Db(n,52).ngClassUntouched,u.Db(n,52).ngClassTouched,u.Db(n,52).ngClassPristine,u.Db(n,52).ngClassDirty,u.Db(n,52).ngClassValid,u.Db(n,52).ngClassInvalid,u.Db(n,52).ngClassPending)}))}function q(l){return u.Lb(0,[(l()(),u.rb(0,0,null,null,1,"app-detail",[],null,null,null,_,k)),u.qb(1,114688,null,0,c,[e.a,C.a,e.a,o.Jb,C.m,o.e,P.b,o.Ib,a.a,r.a],null,null)],(function(l,n){l(n,1,0)}),null)}var y=u.nb("app-detail",c,q,{},{},[]),N=t("x8gb");t.d(n,"DetailPageModuleNgFactory",(function(){return w}));var w=u.ob(d,[],(function(l){return u.Ab([u.Bb(512,u.j,u.Z,[[8,[b.a,y]],[3,u.j],u.v]),u.Bb(4608,h.l,h.k,[u.s,[2,h.r]]),u.Bb(4608,f.p,f.p,[]),u.Bb(4608,o.b,o.b,[u.x,u.g]),u.Bb(4608,o.Ib,o.Ib,[o.b,u.j,u.p]),u.Bb(4608,o.Lb,o.Lb,[o.b,u.j,u.p]),u.Bb(1073742336,h.b,h.b,[]),u.Bb(1073742336,f.o,f.o,[]),u.Bb(1073742336,f.e,f.e,[]),u.Bb(1073742336,o.Fb,o.Fb,[]),u.Bb(1073742336,C.o,C.o,[[2,C.t],[2,C.m]]),u.Bb(1073742336,N.a,N.a,[]),u.Bb(1073742336,d,d,[]),u.Bb(1024,C.k,(function(){return[[{path:"",component:c}]]}),[])])}))}}]);